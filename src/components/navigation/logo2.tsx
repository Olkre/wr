import { useEffect, useRef, useState } from "react";

const DynamicLogo = () => {
  const logoRef = useRef<HTMLDivElement>(null);
  const [isDarkBg, setIsDarkBg] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      console.log("Scroll event triggered");

      if (!logoRef.current) {
        console.log("Logo ref is null");
        return;
      }

      const { top } = logoRef.current.getBoundingClientRect();
      console.log("Logo top position:", top);

      const elementBelow = document.elementFromPoint(
        window.innerWidth / 2,
        top + 10
      ) as HTMLElement;
      console.log("Element below:", elementBelow);

      if (elementBelow) {
        // Check if the element is a child of #navbar
        if (elementBelow.closest("#navbar")) {
          console.log("Element is a child of #navbar, skipping...");
          return; // Ignore this element if it's inside #navbar
        }

        const bgColor = window.getComputedStyle(elementBelow).backgroundColor;
        console.log("Background color of element below:", bgColor);
        setIsDarkBg(isDark(bgColor));
      } else {
        console.log("No element found below logo");
      }
    };

    const isDark = (rgb: string) => {
      const match = rgb.match(/\d+/g);
      if (!match) {
        console.log("No RGB match found");
        return false;
      }
      const [r, g, b] = match.map(Number);
      const luminance = r * 0.299 + g * 0.587 + b * 0.114;
      console.log("Luminance calculated:", luminance);
      return luminance < 128; // luminance formula
    };

    window.addEventListener("scroll", handleScroll);
    handleScroll(); // initial check
    console.log("Scroll event listener added");

    return () => {
      window.removeEventListener("scroll", handleScroll);
      console.log("Scroll event listener removed");
    };
  }, []);

  return (
    <div ref={logoRef} style={{ position: "fixed", top: 20, left: 20 }}>
      <svg
        width="19"
        height="25"
        viewBox="0 0 19 25"
        style={{
          transition: "fill 0.5s ease-in-out", // smooth transition
        }}
        fill={isDarkBg ? "#fff" : "#9C6A53"}
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M8.73395 0.0200767C8.65163 0.0301151 8.49703 0.0582225 8.39262 0.08633C8.28822 0.11243 8.11554 0.170652 8.01114 0.216829C7.90673 0.263005 7.76217 0.335281 7.68989 0.377443C7.61761 0.421611 7.4871 0.513964 7.39876 0.584233C7.28231 0.678594 6.46312 1.56398 4.39508 3.83265C2.83301 5.54921 1.53999 6.96864 1.52392 6.9847C1.50786 7.00076 1.43558 7.08709 1.36531 7.17543C1.29503 7.26376 1.16653 7.44445 1.0802 7.57696C0.991855 7.70947 0.851309 7.95842 0.762966 8.12907C0.67663 8.29972 0.564193 8.54466 0.509982 8.67114C0.457779 8.79763 0.381483 9.00642 0.337311 9.13291C0.295147 9.25939 0.232905 9.46417 0.20078 9.58463C0.168656 9.70509 0.120468 9.92795 0.092359 10.0765C0.0662575 10.2251 0.0341327 10.462 0.0220858 10.6025C0.00602341 10.7772 0 12.4677 0 15.8847C0 19.2275 0.00803122 20.9822 0.020078 21.1288C0.0321249 21.2492 0.0602341 21.4359 0.0843278 21.5403C0.106414 21.6447 0.160624 21.8355 0.204796 21.9619C0.248968 22.0884 0.333295 22.2872 0.395537 22.4036C0.455772 22.5201 0.552146 22.6827 0.608365 22.765C0.664583 22.8473 0.779028 22.9959 0.863356 23.0943C0.945676 23.1926 1.09024 23.3412 1.1846 23.4215C1.27897 23.5038 1.4416 23.6263 1.54601 23.6966C1.65041 23.7668 1.82108 23.8652 1.92147 23.9174C2.02387 23.9676 2.21461 24.0459 2.34311 24.0901C2.47361 24.1342 2.6744 24.1925 2.79085 24.2166L3.00167 24.2607C13.3117 24.2708 14.918 24.2668 15.0585 24.2507C15.1629 24.2366 15.3497 24.2025 15.4701 24.1704C15.5906 24.1403 15.7854 24.078 15.9018 24.0319C16.0183 23.9857 16.1929 23.9014 16.2933 23.8451C16.3937 23.7889 16.5503 23.6885 16.6447 23.6223C16.7391 23.554 16.9157 23.3994 17.0382 23.277C17.1607 23.1565 17.3173 22.9798 17.3876 22.8855C17.4558 22.7911 17.5603 22.6285 17.6205 22.5241C17.6787 22.4197 17.7651 22.243 17.8092 22.1326C17.8554 22.0222 17.9176 21.8314 17.9518 21.711C17.9839 21.5905 18.0241 21.3898 18.0401 21.2693C18.0662 21.0786 18.0702 20.3197 18.0702 15.8385C18.0702 12.4636 18.0622 10.5644 18.0502 10.4479C18.0381 10.3476 18.014 10.1809 17.998 10.0765C17.9799 9.97212 17.9397 9.78139 17.9096 9.6549C17.8775 9.52842 17.8233 9.33367 17.7891 9.22325C17.753 9.11283 17.6747 8.896 17.6145 8.74141C17.5522 8.58682 17.4478 8.35192 17.3816 8.21942C17.3153 8.08691 17.2029 7.87811 17.1286 7.75765C17.0563 7.63518 16.9238 7.44044 16.8354 7.32199C16.7471 7.20554 15.4019 5.70982 13.8458 3.99929C12.2898 2.29076 10.9445 0.821139 10.8542 0.734809C10.7638 0.648479 10.6012 0.51798 10.4908 0.445704C10.3803 0.37142 10.1996 0.271036 10.0892 0.222852C9.97879 0.174668 9.80812 0.11243 9.70773 0.0883376C9.60734 0.0622379 9.43869 0.0321228 9.33027 0.0200767C9.22385 0.00803069 9.07929 0 9.01102 0C8.94075 0.00200767 8.81627 0.0100384 8.73395 0.0200767ZM9.52712 1.99562C9.51105 1.9896 9.497 1.97755 9.497 1.9655C9.497 1.95346 9.50302 1.94543 9.51105 1.94543C9.52109 1.94342 9.60341 2.02373 9.69778 2.1221C9.79215 2.22048 10.1475 2.60595 11.1052 3.66199L11.1173 4.56544C11.1253 5.06134 11.1314 5.78008 11.1314 6.16154C11.1334 6.63134 11.1253 6.91844 11.1073 7.05496C11.0912 7.16538 11.0591 7.36012 11.031 7.48661C11.0049 7.61309 10.9527 7.80783 10.9145 7.91826C10.8831 8.0093 10.8407 8.12628 10.8121 8.20505L10.8121 8.20514L10.812 8.20543L10.812 8.20552L10.796 8.24952C10.7679 8.3218 10.6856 8.51454 10.6113 8.68117C10.537 8.8458 10.4025 9.13089 10.3122 9.31359C10.2218 9.49629 10.0933 9.7352 10.0291 9.84562C9.96482 9.95605 9.85037 10.1367 9.77809 10.2472C9.7038 10.3576 9.59538 10.5061 9.53716 10.5784C9.47893 10.6507 9.35244 10.7872 9.25807 10.8816C9.1637 10.9759 9.00509 11.1064 8.9047 11.1727C8.80431 11.2369 8.65171 11.3152 8.56337 11.3454C8.47503 11.3755 8.34452 11.4076 8.27224 11.4136C8.18791 11.4216 8.07547 11.4136 7.95501 11.3935C7.85462 11.3755 7.72812 11.3454 7.67592 11.3253C7.58758 11.2932 7.57553 11.2811 7.53537 11.1747C7.50927 11.1125 7.47916 10.99 7.46711 10.9057C7.45305 10.8093 7.45105 10.6507 7.45908 10.4981C7.4651 10.3596 7.48518 10.1528 7.50124 10.0364C7.5173 9.91991 7.55144 9.71713 7.57955 9.58463C7.60766 9.45212 7.66588 9.20919 7.71005 9.04255C7.75423 8.87792 7.83253 8.6109 7.88072 8.45029C7.93091 8.28968 7.99315 8.04675 8.02126 7.90822C8.04737 7.76969 8.1076 7.52275 8.15378 7.35611C8.19795 7.19148 8.31039 6.8301 8.40275 6.55304L8.56373 6.07478C8.63118 5.87455 8.70084 5.66777 8.75411 5.50905C8.85651 5.2099 8.99706 4.77223 9.06934 4.53533C9.13961 4.29842 9.23799 3.94507 9.28618 3.75233C9.33638 3.5596 9.39862 3.28455 9.42673 3.13999C9.45483 2.99544 9.497 2.74047 9.51708 2.57383C9.53916 2.40518 9.55723 2.20843 9.55723 2.13616C9.55723 2.03778 9.5492 2.00365 9.52712 1.99562ZM4.22651 6.68354L5.66009 5.10952C6.44714 4.24221 7.10169 3.53751 7.10972 3.54354C7.11976 3.54755 7.09968 3.65396 7.06555 3.77643C7.03142 3.9009 6.96315 4.13379 6.91296 4.29441C6.86477 4.45502 6.68407 5.01516 6.5134 5.53916C6.34073 6.06317 6.15802 6.64138 6.10381 6.82407C6.05161 7.00677 5.9713 7.31796 5.92512 7.51672C5.87894 7.71548 5.80465 8.0086 5.76048 8.16922L5.71752 8.32453C5.67543 8.47635 5.62472 8.65925 5.58981 8.79159C5.53962 8.97429 5.46934 9.27544 5.4312 9.46416C5.39305 9.65289 5.34888 9.9179 5.33081 10.0564C5.31474 10.195 5.30069 10.456 5.30069 10.6387C5.30069 10.8274 5.31274 11.0522 5.33081 11.1606C5.34687 11.265 5.37699 11.4136 5.39907 11.4919C5.42116 11.5702 5.47135 11.7047 5.51151 11.7931C5.55166 11.8814 5.62395 12.0119 5.67213 12.0842C5.71831 12.1565 5.82874 12.2829 5.91508 12.3653C6.00342 12.4496 6.14999 12.564 6.24436 12.6222C6.33872 12.6805 6.50537 12.7628 6.6158 12.8069C6.72623 12.8491 6.925 12.9133 7.05752 12.9475C7.19003 12.9816 7.42896 13.0278 7.58959 13.0519C7.83855 13.086 7.94296 13.092 8.30236 13.082C8.64971 13.074 8.76616 13.0619 8.96493 13.0198C9.09745 12.9916 9.30023 12.9374 9.41669 12.8973C9.53314 12.8571 9.73593 12.7708 9.86844 12.7066C10.001 12.6423 10.1877 12.5379 10.2841 12.4717C10.3804 12.4074 10.529 12.299 10.6153 12.2307C10.7017 12.1625 10.8764 11.9999 11.0049 11.8694C11.1314 11.7389 11.294 11.5602 11.3663 11.4718C11.4385 11.3835 11.561 11.2209 11.6393 11.1105C11.7176 11 11.8602 10.7792 11.9566 10.6186C12.0509 10.458 12.2196 10.1508 12.328 9.93597C12.4364 9.72115 12.591 9.39992 12.6693 9.22324C12.7496 9.04657 12.842 8.83376 12.8741 8.75144C12.9083 8.66913 12.9725 8.48844 13.0207 8.34991C13.0669 8.21138 13.1291 7.99455 13.1592 7.86806C13.1873 7.74158 13.2235 7.54684 13.2395 7.43641C13.2576 7.32599 13.2797 7.12723 13.2917 6.99473C13.3018 6.86222 13.3118 6.60323 13.3118 6.08123L13.4885 6.27598C13.5869 6.38439 14.0447 6.88832 14.5085 7.39626C15.0385 7.98049 15.3959 8.39006 15.4742 8.50651C15.5445 8.6089 15.6007 8.69523 15.6007 8.70125C15.6007 8.70727 15.5445 8.78156 15.4782 8.86789C15.41 8.95221 15.3136 9.07066 15.2614 9.13089C15.2112 9.18911 15.153 9.25737 15.1329 9.28147C15.1128 9.30355 15.0446 9.38185 14.9823 9.45413C14.932 9.51255 14.8227 9.63263 14.719 9.7465L14.7187 9.74675L14.647 9.82555C14.5265 9.95805 14.2675 10.2291 14.0748 10.4278C13.882 10.6266 13.2054 11.3132 12.5689 11.9537C11.9325 12.5941 11.3 13.2406 11.1615 13.3892C11.0249 13.5377 10.8302 13.7505 10.7318 13.861C10.6769 13.9214 10.6268 13.977 10.5917 14.0159C10.5626 14.0482 10.5438 14.069 10.5411 14.0718C10.535 14.0778 10.4808 14.14 10.4186 14.2123C10.3563 14.2846 10.258 14.401 10.1977 14.4733C10.1375 14.5456 9.99293 14.7263 9.87647 14.8748C9.76002 15.0234 9.60542 15.2262 9.53314 15.3266C9.46287 15.427 9.34641 15.5936 9.27614 15.698C9.20587 15.8024 9.0854 15.9931 9.0091 16.1196C8.93281 16.2461 8.81234 16.4589 8.74206 16.5914C8.6738 16.7239 8.56939 16.9407 8.51117 17.0732C8.45495 17.2058 8.3646 17.4447 8.3124 17.6053C8.25818 17.7659 8.19193 18.0008 8.16382 18.1273C8.13571 18.2538 8.09957 18.4485 8.0815 18.5589C8.06544 18.6693 8.04134 18.9183 8.02729 19.111C8.00922 19.3801 8.00922 19.5487 8.02729 19.8338C8.04134 20.0386 8.06945 20.3217 8.09154 20.4662C8.11161 20.6108 8.15779 20.8577 8.19193 21.0183C8.22405 21.1789 8.29031 21.4399 8.33448 21.6006C8.38066 21.7612 8.45696 22.0081 8.50314 22.1527L8.50325 22.153L8.50343 22.1535C8.5515 22.2978 8.59551 22.4298 8.60152 22.4498C8.61357 22.4819 8.55534 22.4839 6.52545 22.4839V22.2992C6.52545 22.1968 6.51541 21.968 6.50537 21.7913C6.49332 21.6146 6.46522 21.2934 6.44313 21.0786C6.42104 20.8637 6.38089 20.5325 6.35278 20.3458C6.32467 20.159 6.27046 19.8338 6.23231 19.623C6.19416 19.4122 6.12188 19.0568 6.07169 18.83C6.02149 18.6031 5.93515 18.2377 5.88094 18.0169C5.82473 17.796 5.7163 17.3804 5.64001 17.0933C5.5617 16.8062 5.39104 16.1919 5.26053 15.7281C5.13003 15.2643 4.97141 14.6942 4.90917 14.4633C4.84693 14.2324 4.74654 13.8429 4.6863 13.6C4.62607 13.357 4.52768 12.9374 4.46745 12.6664C4.40722 12.3954 4.3269 12.0079 4.28876 11.8031C4.25061 11.5983 4.19037 11.2691 4.15825 11.0703C4.12612 10.8715 4.07593 10.5463 4.04782 10.3475C4.01971 10.1488 3.98156 9.86369 3.9655 9.71512C3.94944 9.56656 3.92936 9.29552 3.92334 9.11282C3.9153 8.92009 3.91932 8.64303 3.93337 8.45029C3.94743 8.26759 3.96952 8.02065 3.98558 7.89818C4.00164 7.77571 4.03778 7.55085 4.06589 7.39626C4.094 7.24167 4.14219 7.01882 4.22651 6.68354ZM1.83924 10.5021C1.80912 10.7089 1.80711 11.1847 1.80711 15.8686V21.0083C1.94766 21.46 2.01592 21.6387 2.05206 21.6989C2.0882 21.7572 2.16852 21.8616 2.23076 21.9298C2.29099 21.9961 2.39941 22.0964 2.47169 22.1507C2.54197 22.2049 2.67247 22.2832 2.76082 22.3233C2.84916 22.3655 2.97967 22.4157 3.05195 22.4357C3.16037 22.4639 3.28686 22.4719 3.79484 22.4799L4.40722 22.4879C4.38312 21.9479 4.35702 21.6006 4.33494 21.3697C4.31486 21.1388 4.26868 20.7613 4.23655 20.5305C4.20242 20.3016 4.14419 19.9462 4.10605 19.7374C4.06589 19.5306 3.99361 19.1813 3.94341 18.9605C3.89322 18.7396 3.82094 18.4324 3.78279 18.2779C3.74464 18.1233 3.67638 17.8603 3.6322 17.6956C3.5943 17.5526 3.50613 17.2308 3.42352 16.9292L3.42317 16.9279L3.42298 16.9272L3.42296 16.9272L3.42284 16.9267L3.38324 16.7821C3.28887 16.4448 3.12222 15.8385 3.01179 15.431C2.90136 15.0254 2.73873 14.4071 2.65039 14.0557C2.56405 13.7064 2.44559 13.2165 2.39138 12.9676C2.33717 12.7186 2.25485 12.3311 2.21068 12.1043C2.16651 11.8774 2.09824 11.502 2.06009 11.2711C2.02195 11.0402 1.97577 10.7451 1.9577 10.6186C1.93963 10.4921 1.92356 10.3636 1.91955 10.3315C1.91553 10.3014 1.90549 10.2773 1.89345 10.2773C1.8814 10.2773 1.85731 10.3797 1.83924 10.5021ZM14.3137 12.8571C14.9924 12.1725 15.7051 11.4477 15.8999 11.247C16.0926 11.0462 16.2593 10.8876 16.2673 10.8956C16.2753 10.9037 16.2814 11.8172 16.2733 14.9411L16.1328 14.9692C16.0565 14.9853 15.8979 15.0294 15.7814 15.0676C15.665 15.1077 15.4843 15.18 15.3799 15.2302C15.2755 15.2804 15.0907 15.3868 14.9683 15.4651C14.8478 15.5454 14.6611 15.6819 14.5567 15.7703C14.4523 15.8566 14.2896 16.0052 14.1933 16.0995C14.0989 16.1939 13.9624 16.3384 13.8901 16.4208C13.8158 16.5031 13.6873 16.6617 13.601 16.7721C13.5166 16.8825 13.346 17.1254 13.2215 17.3142C13.097 17.5009 12.9384 17.7599 12.8661 17.8864C12.7938 18.0128 12.6954 18.1935 12.6452 18.2879C12.595 18.3823 12.4846 18.6071 12.3983 18.7898C12.3139 18.9725 12.2176 19.1974 12.1875 19.2917C12.1573 19.3861 12.1152 19.5567 12.0971 19.6732C12.069 19.8398 12.063 19.9502 12.073 20.1952C12.081 20.3959 12.0991 20.5786 12.1272 20.7071C12.1513 20.8176 12.1935 20.9802 12.2216 21.0685C12.2497 21.1569 12.3079 21.3235 12.3521 21.4399C12.3943 21.5564 12.5208 21.8334 12.6312 22.0563L12.661 22.1181C12.7557 22.3144 12.83 22.4684 12.83 22.4739C12.83 22.4799 12.3983 22.4839 10.9125 22.4839L10.8884 22.4197C10.8796 22.3933 10.8334 22.2599 10.7747 22.0906L10.7741 22.0889L10.7057 21.8917C10.6174 21.6367 10.5089 21.2934 10.4628 21.1287C10.4186 20.9621 10.3583 20.7152 10.3322 20.5766C10.3041 20.4381 10.266 20.2092 10.2479 20.0647C10.2258 19.896 10.2138 19.6571 10.2138 19.3921C10.2138 19.109 10.2238 18.9042 10.2479 18.7396C10.268 18.6071 10.3001 18.4184 10.3222 18.318C10.3443 18.2176 10.4045 18.0108 10.4567 17.8562C10.5129 17.6836 10.6194 17.4326 10.7358 17.2037C10.8362 16.999 11.0008 16.7079 11.0972 16.5553C11.1936 16.4047 11.3602 16.1618 11.4646 16.0152C11.5691 15.8707 11.7498 15.6337 11.8662 15.4892C11.9807 15.3446 12.0991 15.1981 12.1292 15.166C12.1442 15.1478 12.1778 15.1093 12.2191 15.062L12.2193 15.0617L12.2194 15.0617L12.2195 15.0615C12.2558 15.02 12.2978 14.9719 12.338 14.925C12.4264 14.8247 12.6272 14.5998 12.7898 14.4231C12.9504 14.2485 13.6351 13.5438 14.3137 12.8571ZM15.9601 17.0773C15.8115 17.2298 15.6067 17.4627 15.5064 17.5952C15.408 17.7277 15.2534 17.9446 15.165 18.0771C15.0767 18.2096 14.9442 18.4204 14.8719 18.5429C14.7976 18.6673 14.6751 18.8942 14.5988 19.0448C14.5245 19.1974 14.4181 19.4303 14.3639 19.5628C14.2716 19.7936 14.2675 19.8137 14.2595 20.0446C14.2535 20.2193 14.2595 20.3317 14.2836 20.4562C14.3037 20.5505 14.3539 20.7352 14.4001 20.8678C14.4442 21.0003 14.5366 21.2251 14.6049 21.3697C14.6731 21.5142 14.7815 21.725 14.8458 21.8415C14.91 21.9579 15.0044 22.1246 15.0546 22.2109C15.1068 22.2972 15.161 22.3715 15.1751 22.3755C15.1871 22.3795 15.2654 22.3514 15.3457 22.3133C15.424 22.2751 15.5525 22.1948 15.6288 22.1366C15.7071 22.0804 15.8216 21.968 15.8858 21.8917C15.9501 21.8154 16.0424 21.6708 16.0926 21.5704C16.1428 21.4701 16.2031 21.3175 16.2272 21.2291L16.2733 21.0685C16.2834 17.2098 16.2794 16.8022 16.2593 16.8022C16.2452 16.8022 16.1107 16.9267 15.9601 17.0773Z"
        />
      </svg>
    </div>
  );
};

export default DynamicLogo;
